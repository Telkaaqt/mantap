#!/bin/bash

# Update and install packages
sudo apt-get update -y && sudo apt-get upgrade -y
sudo apt-get install -y --no-install-recommends \
    ffmpeg git neofetch apt-utils libmediainfo0v5 \
    libgl1-mesa-glx libglib2.0-0 fonts-noto-color-emoji \
    tmux python3-venv python3-pip sqlite3 net-tools lsof locales

sudo apt-get clean
sudo rm -rf /var/lib/apt/lists/*

# Setup locale
echo "Setting up locale..."
echo "en_US.UTF-8 UTF-8" | sudo tee -a /etc/locale.gen
sudo locale-gen
sudo update-locale LANG=en_US.UTF-8
export LC_ALL=en_US.UTF-8
export LANG=en_US.UTF-8

# Setup swap
echo "Setting up swap..."
sudo fallocate -l 8G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab

# Configure swappiness and cache pressure
echo "Configuring memory management parameters..."
echo 'vm.swappiness=90' | sudo tee -a /etc/sysctl.conf
echo 'vm.vfs_cache_pressure=200' | sudo tee -a /etc/sysctl.conf
sudo sysctl vm.swappiness=90
sudo sysctl vm.vfs_cache_pressure=200
sudo sysctl -p

# Ulimit configuration
echo "* soft nofile 4096" | sudo tee -a /etc/security/limits.conf
echo "* hard nofile 8192" | sudo tee -a /etc/security/limits.conf

# Add locale environment to bashrc
echo "export LC_ALL=en_US.UTF-8" | sudo tee -a /etc/bash.bashrc
echo "export LANG=en_US.UTF-8" | sudo tee -a /etc/bash.bashrc

# Show status
echo "Swap status:"
sudo swapon --show
echo "Memory usage:"
free -h
echo "Locale verification:"
locale -a | grep en_US

echo "Setup completed successfully!"
echo "Please reboot or run: source /etc/bash.bashrc"